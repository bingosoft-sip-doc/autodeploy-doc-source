### 创建部署方案

在刚刚创建好的版本右侧，点击新建部署方案。

![输入图片说明](..\image\schema-create.png "在这里输入图片标题")

选择自动新建一个流程模型，或者关联已有的模型。

![img](..\image\schema-create2.png)

创建成功之后，点击方案的名称，进入设计器编辑。

![输入图片说明](..\image\designer.png "在这里输入图片标题")

### 编辑部署方案

上图中展现了一份流程模型的示例，我们大致可以将一份流程模型切分为两个部分：

1. 流程的部分：与其他所有的流程设计一样，可以使用网关，子流程等。
2. 运行的服务单元：每一个服务单元是一个最小的编排单位，承载着一份独立的能力交付

对于流程的设计和参数的引用，请参考https://siprs-doc.github.io/designer/modelDesigne.html

对于各服务单元的能力及其输入输出定义，可以参阅本文档第5，第6节内容，也可以在菜单**高级服务->执行器**中查看。

> 下面列举一些常见的流程设计供您参考

#### 设计一个最简单的流程

按照以下步骤设计一个可用的模型

1. 开始事件：所有的流程必须从开始事件开始，并且只有一个开始事件
2. 从资源服务拖动一个实例，填写名称等信息
3. 从流程控制中拖动一个结束事件，一个流程只能有一个结束事件

> 编辑结束后，关闭设计器，如果是在流程模型菜单中编辑的模型，需要手工点击发布按钮，才能生效；部署方案中编辑的模型，在关闭设计器时，会自动发布。

#### 并行流程的设计

![img](../image/example-bingxing.png)

通过一个并行网关，分出两个分支，并行创建两台实例。

比如并行创建两个实例，连个存储卷等，都可以用到并行网关。

此外，并行网关还可以有等待的作用，例如某些需要等待其他机器的脚本都运行成功之后才运行的场景，也可以使用并行网关。

#### 子流程处理多机部署的问题

在多机部署的场景中，几台机器执行的一系列动作都是相同的，这种场景可以借用子流程来做。

![img](..\image\subprocess.png)

例如，一主多从的web负载场景，web节点通过子流程，只需要描述一次tomcat的部署过程即可。子流程的类型设置为`Parallel`表示子流程并行执行。多实例的数量，可以通过参数引用的方式取值，表示多机器的数量。

子流程根据循环调用的数量，会在编号后加上后缀，例如tomcat服务器的编号为tomcat，则实际产生的实例为tomcat01,tomcat02。

如果负载均衡节点，要获取所有tomcat的IP地址，则可以通过`${outputs.tomcat.privateIp}`，得到的将会是一个数组。

子流程内部的引用可以忽略后缀带来的影响，直接以`${outputs.tomcat.privateIp}`表达式，就可以取到当前循环的机器IP地址了。